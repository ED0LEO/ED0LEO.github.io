<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Integrated Development Environment</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdn.jsdelivr.net/pyodide/v0.22.1/full/pyodide.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.5/split.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Courier New', monospace;
            background-color: #282a36;
            color: #f8f8f2;
            overflow: hidden;
        }
        .container {
            display: flex;
            height: 100%;
        }
        .pane {
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        iframe {
            flex: 1;
            border: none;
            background-color: #fff;
        }
        #terminal, #filesystem {
            background-color: #282a36;
            color: #50fa7b;
            font-family: 'Courier New', monospace;
            padding: 10px;
            overflow-y: auto;
            flex: 1;
        }
        #terminalInput {
            width: 100%;
            background-color: #44475a;
            color: #50fa7b;
            border: none;
            font-family: 'Courier New', monospace;
            outline: none;
            padding: 5px;
        }
        .CodeMirror {
            height: 100%;
        }
        h2 {
            margin: 0;
            padding: 10px;
            background-color: #44475a;
            color: #bd93f9;
        }
        .gutter {
            background-color: #44475a;
            background-repeat: no-repeat;
            background-position: 50%;
        }
        .gutter.gutter-horizontal {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg==');
            cursor: col-resize;
        }
        .gutter.gutter-vertical {
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFAQMAAABo7865AAAABlBMVEVHcEzMzMzyAv2sAAAAAXRSTlMAQObYZgAAABBJREFUeF5jOAMEEAIEEFwAn3kMwcB6I2AAAAAASUVORK5CYII=');
            cursor: row-resize;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="pane" id="left-pane">
            <div class="pane" id="filesystem-pane">
                <h2>Filesystem</h2>
                <div id="filesystem"></div>
            </div>
            <div class="pane" id="browser-pane">
                <h2>Browser</h2>
                <iframe src="https://docs.python.org/3/" title="Python Documentation"></iframe>
            </div>
        </div>
        <div class="pane" id="right-pane">
            <div class="pane" id="editor-pane">
                <h2>Python Editor</h2>
                <textarea id="code-editor">
# Write your Python code here
def greet(name):
    return f"Hello, {name}!"

print(greet('Python World'))
                </textarea>
            </div>
            <div class="pane" id="terminal-pane">
                <h2>Terminal</h2>
                <div id="terminal"></div>
                <input type="text" id="terminalInput" placeholder="Enter command...">
            </div>
        </div>
    </div>
    <script>
        // Initialize Split.js
        Split(['#left-pane', '#right-pane'], {
            direction: 'horizontal',
            sizes: [25, 75],
            minSize: 200
        });

        Split(['#filesystem-pane', '#browser-pane'], {
            direction: 'vertical',
            sizes: [30, 70],
            minSize: 100
        });

        Split(['#editor-pane', '#terminal-pane'], {
            direction: 'vertical',
            sizes: [70, 30],
            minSize: 100
        });

        // Initialize CodeMirror
        const editor = CodeMirror.fromTextArea(document.getElementById("code-editor"), {
            lineNumbers: true,
            mode: "python",
            theme: "dracula"
        });

        // Ensure CodeMirror refreshes when the window is resized
        new ResizeObserver(() => editor.refresh()).observe(document.getElementById('editor-pane'));

        const terminal = document.getElementById('terminal');
        const terminalInput = document.getElementById('terminalInput');
        const filesystem = document.getElementById('filesystem');

        function addToTerminal(text) {
            terminal.innerHTML += `<div>${text}</div>`;
            terminal.scrollTop = terminal.scrollHeight;
        }

        // Initialize Pyodide
        let pyodide;
        async function initPyodide() {
            pyodide = await loadPyodide();
            await pyodide.loadPackage("micropip");
            pyodide.runPython(`
                import sys
                import io
                import micropip
                
                class CaptureOutput:
                    def __enter__(self):
                        self.old_stdout = sys.stdout
                        self.old_stderr = sys.stderr
                        self.stdout = io.StringIO()
                        self.stderr = io.StringIO()
                        sys.stdout = self.stdout
                        sys.stderr = self.stderr
                        return self
                    
                    def __exit__(self, *args):
                        sys.stdout = self.old_stdout
                        sys.stderr = self.old_stderr

                async def install_package(package_name):
                    await micropip.install(package_name)
                    return f"Package '{package_name}' installed successfully."

                # Simulated filesystem
                filesystem = {
                    'home': {
                        'user': {
                            'documents': {
                                'hello.py': '# This is a Python file\\nprint("Hello, World!")'
                            },
                            'images': {}
                        }
                    }
                }

                def list_files(path):
                    current = filesystem
                    for part in path.split('/'):
                        if part:
                            current = current.get(part, {})
                    return '\\n'.join(current.keys())

                def read_file(path):
                    current = filesystem
                    parts = path.split('/')
                    for part in parts[:-1]:
                        if part:
                            current = current.get(part, {})
                    return current.get(parts[-1], 'File not found')

                def write_file(path, content):
                    global filesystem
                    current = filesystem
                    parts = path.split('/')
                    for part in parts[:-1]:
                        if part:
                            current = current.setdefault(part, {})
                    current[parts[-1]] = content
                    return 'File written successfully'
            `);
            addToTerminal("Python environment loaded. Type 'help' for available commands.");
            updateFilesystem();
        }
        initPyodide();

        function updateFilesystem() {
            pyodide.runPython(`
                fs_structure = list_files('home')
            `);
            const fs_structure = pyodide.globals.get('fs_structure');
            filesystem.innerHTML = `<pre>${fs_structure}</pre>`;
        }

        terminalInput.addEventListener('keyup', async function(event) {
            if (event.key === 'Enter') {
                const command = this.value;
                addToTerminal(`> ${command}`);
                
                if (command === 'help') {
                    addToTerminal('Available commands: help, clear, date, run, install <package_name>, ls <path>, cat <file>, write <file> <content>');
                } else if (command === 'clear') {
                    terminal.innerHTML = '';
                } else if (command === 'date') {
                    addToTerminal(new Date().toString());
                } else if (command === 'run') {
                    try {
                        const code = editor.getValue();
                        const result = await pyodide.runPythonAsync(`
                            with CaptureOutput() as output:
                                exec(${JSON.stringify(code)})
                            output.stdout.getvalue() + output.stderr.getvalue()
                        `);
                        if (result.trim() !== '') {
                            addToTerminal(result);
                        } else {
                            addToTerminal('Code executed successfully (no output).');
                        }
                    } catch (error) {
                        addToTerminal(`Error: ${error.message}`);
                    }
                } else if (command.startsWith('install ')) {
                    const package_name = command.split(' ')[1];
                    try {
                        const result = await pyodide.runPythonAsync(`
                            await install_package("${package_name}")
                        `);
                        addToTerminal(result);
                    } catch (error) {
                        addToTerminal(`Error installing package: ${error.message}`);
                    }
                } else if (command.startsWith('ls ')) {
                    const path = command.split(' ')[1];
                    const result = pyodide.runPython(`list_files("${path}")`);
                    addToTerminal(result);
                } else if (command.startsWith('cat ')) {
                    const path = command.split(' ')[1];
                    const result = pyodide.runPython(`read_file("${path}")`);
                    addToTerminal(result);
                } else if (command.startsWith('write ')) {
                    const [, path, ...contentArr] = command.split(' ');
                    const content = contentArr.join(' ');
                    const result = pyodide.runPython(`write_file("${path}", ${JSON.stringify(content)})`);
                    addToTerminal(result);
                    updateFilesystem();
                } else {
                    addToTerminal(`Command not found: ${command}`);
                }

                this.value = '';
            }
        });

        // Initial terminal message
        addToTerminal('Initializing Python environment...');
    </script>
</body>
</html>
