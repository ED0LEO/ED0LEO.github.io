<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Scientific Desktop Environment</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <!-- QuantumConnect Window -->
    <script src="quantumconnect.js"></script>
    <style>
        .loading-spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #3498db;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.notification-badge {
    background-color: red;
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 12px;
    position: absolute;
    top: -5px;
    right: -5px;
}
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
            overflow: hidden;
            background-color: #f0f2f5;
            color: #333;
        }
        .desktop {
            position: relative;
            width: 100%;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
        }
        .window {
            position: absolute;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1), 0 1px 3px rgba(0,0,0,0.08);
            overflow: hidden;
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        .window:hover {
            box-shadow: 0 10px 20px rgba(0,0,0,0.15), 0 3px 6px rgba(0,0,0,0.10);
            transform: translateY(-2px);
        }
        .window-header {
            background-color: #4a69bd;
            color: #ffffff;
            padding: 12px 16px;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }
        .window-content {
            padding: 16px;
            color: #333;
            font-size: 14px;
            height: calc(100% - 52px);
            overflow-y: auto;
        }
        .close-btn {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 20px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        .close-btn:hover {
            opacity: 1;
        }
        #browser {
            width: 1000px;
            height: 700px;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            z-index: 2;
        }
        #browser.minimized {
            display: none;
        }
        #browser-content {
            flex-grow: 1;
            overflow-y: auto;
            background-color: white;
            padding: 16px;
            box-sizing: border-box;
        }
        #browser-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .browser-bar {
            display: flex;
            padding: 8px;
            background-color: #f1f3f5;
            border-bottom: 1px solid #e1e4e8;
        }
        .browser-bar input {
            flex-grow: 1;
            margin: 0 8px;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        .browser-bar button {
            padding: 8px 12px;
            margin: 0 4px;
            background-color: #4a69bd;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .browser-bar button:hover {
            background-color: #3c5aa6;
        }
        .chart-container {
            width: 100%;
            height: 100%;
        }
        #taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #2c3e50;
            padding: 8px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            z-index: 1000;
        }
        .taskbar-item {
            background-color: #34495e;
            color: #ecf0f1;
            padding: 8px 16px;
            margin-right: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .taskbar-item:hover {
            background-color: #2980b9;
        }
        #clock {
            margin-left: auto;
            margin-right: 16px;
            color: #ecf0f1;
            font-size: 14px;
        }
        .nexus-search-container {
            max-width: 800px;
            margin: 50px auto;
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
        }
        .nexus-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        .nexus-logo h1 {
            font-size: 48px;
            color: #4a69bd;
            margin: 0;
        }
        .nexus-logo span {
            color: #e74c3c;
        }
        .nexus-search-bar {
            display: flex;
            margin-bottom: 20px;
        }
        .nexus-search-input {
            flex-grow: 1;
            padding: 12px 20px;
            font-size: 16px;
            border: 2px solid #ced4da;
            border-right: none;
            border-radius: 25px 0 0 25px;
            outline: none;
            transition: border-color 0.2s ease;
        }
        .nexus-search-input:focus {
            border-color: #4a69bd;
        }
        .nexus-search-button {
            padding: 12px 25px;
            font-size: 16px;
            background-color: #4a69bd;
            color: white;
            border: none;
            border-radius: 0 25px 25px 0;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .nexus-search-button:hover {
            background-color: #3c5aa6;
        }
        .nexus-search-results {
            margin-top: 30px;
        }
        .nexus-result-item {
            margin-bottom: 20px;
            padding: 16px;
            border-radius: 8px;
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        .nexus-result-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        .nexus-result-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        .nexus-result-title a {
            text-decoration: none;
            color: #4a69bd;
            transition: color 0.2s ease;
        }
        .nexus-result-title a:hover {
            color: #3c5aa6;
        }
        .nexus-result-meta {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 8px;
        }
        .nexus-result-snippet {
            font-size: 14px;
            color: #34495e;
            line-height: 1.5;
        }
        /* New styles for improved focus */
        .focus-mode {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
        }
        .pomodoro-timer {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #4a69bd;
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 16px;
            z-index: 1001;
        }
        .note-taking {
            position: fixed;
            bottom: 60px;
            right: 20px;
            width: 300px;
            height: 200px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: both;
            overflow: auto;
        }
        .window-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }

        #virtual-lab {
            display: flex;
            flex-direction: column;
        }

        #lab-controls {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
        }

        #lab-visualization {
            flex-grow: 1;
            border: 1px solid #ccc;
            border-radius: 4px;
            overflow: hidden;
        }

        #ai-assistant {
            display: flex;
            flex-direction: column;
        }

        #ai-chat {
            flex-grow: 1;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
        }

        #ai-input {
            display: flex;
        }

        #ai-input input {
            flex-grow: 1;
            margin-right: 10px;
        }

        #iss-livestream .window-content {
            padding: 0;
            display: flex;
            flex-direction: column;
        }
        #video-container {
            flex-grow: 1;
        }
        #stream-controls {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background-color: #f1f3f5;
        }
        
        #stream-controls button {
            padding: 5px 10px;
            background-color: #4a69bd;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        #stream-controls button:hover {
            background-color: #3c5aa6;
        }

        #particle-simulator {
            display: flex;
            flex-direction: column;
        }

        #simulator-controls {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
        }

        #simulator-visualization {
            flex-grow: 1;
            border: 1px solid #ccc;
            border-radius: 4px;
            overflow: hidden;
        }
        #quantumconnect-window .window-content {
    display: flex;
    flex-direction: column;
}
#quantumconnect-nav {
    display: flex;
    justify-content: space-around;
    padding: 10px;
    background-color: #1a237e;
}
#quantumconnect-nav button {
    padding: 5px 10px;
    background-color: #3f51b5;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}
#quantumconnect-nav button:hover {
    background-color: #5c6bc0;
}
#quantumconnect-main {
    flex-grow: 1;
    overflow-y: auto;
    padding: 20px;
}
.quantum-post {
    border: 1px solid #c5cae9;
    border-radius: 5px;
    padding: 10px;
    margin-bottom: 15px;
    background-color: #e8eaf6;
}
.quantum-post-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    color: #3f51b5;
}
.quantum-post-actions {
    display: flex;
    justify-content: space-around;
    margin-top: 10px;
}
.quantum-post-actions button {
    background: none;
    border: none;
    color: #3f51b5;
    cursor: pointer;
}
.quantum-profile-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
}
.quantum-profile-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    margin-right: 20px;
    background-color: #c5cae9;
}
.quantum-profile-info {
    flex-grow: 1;
}
.quantum-trend-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding: 5px;
    background-color: #e8eaf6;
    border-radius: 5px;
}
        .quantum-media {
    margin: 10px 0;
    border: 1px solid #e1e4e8;
    border-radius: 6px;
    overflow: hidden;
}

.quantum-image, .quantum-gif {
    max-width: 100%;
    height: auto;
    display: block;
}

.quantum-media-caption {
    padding: 10px;
    background-color: #f6f8fa;
    color: #24292e;
    font-style: italic;
}

.quantum-media iframe {
    width: 100%;
    max-width: 560px;
    margin: 0 auto;
    display: block;
}
    </style>
</head>
<body>
    <div class="desktop">
        <div class="window" id="browser">
            <div class="window-header">
                Scientific Browser
                <button class="close-btn">&times;</button>
            </div>
            <div class="browser-bar">
                <button onclick="goBack()">&larr;</button>
                <button onclick="goForward()">&rarr;</button>
                <input type="text" id="url-bar" value="https://nexussearch.com">
                <button onclick="navigateTo()">Go</button>
            </div>
            <div id="browser-content"></div>
        </div>

        <div class="window" style="width: 700px; height: 550px; top: 30px; right: 10px;">
            <div class="window-header">
                CERN LHC Status
                <button class="close-btn">&times;</button>
            </div>
            <div class="window-content">
                <iframe src="https://op-webtools.web.cern.ch/vistar/vistars.php?usr=LHC3" width="100%" height="100%" frameborder="0"></iframe>
            </div>
        </div>

        <div class="window" style="width: 550px; height: 450px; bottom: 60px; left: 20px;">
            <div class="window-header">
                NASA Exoplanet Archive
                <button class="close-btn">&times;</button>
            </div>
            <div class="window-content">
                <iframe src="https://exoplanetarchive.ipac.caltech.edu/cgi-bin/TblView/nph-tblView?app=ExoTbls&config=PS" width="100%" height="100%" frameborder="0"></iframe>
            </div>
        </div>

        <div class="window" style="width: 500px; height: 400px; top: 590px; right: 20px;">
            <div class="window-header">
                Global Temperature Anomalies
                <button class="close-btn">&times;</button>
            </div>
            <div class="window-content">
                <div class="chart-container">
                    <canvas id="temperatureChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Virtual Lab Window -->
        <div class="window" id="virtual-lab" style="width: 600px; height: 450px; top: 70px; left: 500px;">
            <div class="window-header">
                <img src="https://img.icons8.com/color/48/000000/test-tube.png" class="window-icon" alt="Virtual Lab Icon">
                Virtual Lab
                <button class="close-btn">&times;</button>
            </div>
            <div class="window-content">
                <div id="lab-controls">
                    <button onclick="runExperiment()">Run Experiment</button>
                    <select id="experiment-type">
                        <option value="pcr">PCR</option>
                        <option value="electrophoresis">Gel Electrophoresis</option>
                        <option value="chromatography">Chromatography</option>
                    </select>
                    <button onclick="analyzeResults()">Analyze Results</button>
                </div>
                <div id="lab-visualization"></div>
            </div>
        </div>

        <!-- AI Research Assistant Window -->
        <div class="window" id="ai-assistant" style="width: 350px; height: 500px; top: 100px; right: 50px;">
            <div class="window-header">
                <img src="https://img.icons8.com/color/48/000000/artificial-intelligence.png" class="window-icon" alt="AI Assistant Icon">
                AI Research Assistant
                <button class="close-btn">&times;</button>
            </div>
            <div class="window-content">
                <div id="ai-chat"></div>
                <div id="ai-input">
                    <input type="text" id="ai-query" placeholder="Ask a research question...">
                    <button onclick="askAI()">Ask</button>
                </div>
            </div>
        </div>

        <div class="window" id="iss-livestream" style="width: 640px; height: 480px; bottom: 50px; right: 30px;">
            <div class="window-header">
                <img src="https://img.icons8.com/color/48/000000/nasa.png" class="window-icon" alt="NASA ISS Live Stream Icon">
                NASA ISS Live Stream
                <button class="close-btn">&times;</button>
            </div>
            <div class="window-content">
                <div id="video-container">
                    <iframe width="100%" height="100%" src="https://www.youtube.com/embed/86YLFOog4GM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                <div id="stream-controls">
                    <button onclick="toggleAudio()">Toggle Audio</button>
                    <button onclick="toggleFullscreen()">Fullscreen</button>
                    <a href="https://www.nasa.gov/mission_pages/station/main/index.html" target="_blank">
                        <button>Learn More</button>
                    </a>
                </div>
            </div>
        </div>

        <!-- Particle Physics Simulator Window -->
        <div class="window" id="particle-simulator" style="width: 550px; height: 400px; top: 30px; left: 30px;">
            <div class="window-header">
                <img src="https://img.icons8.com/color/48/000000/atom.png" class="window-icon" alt="Particle Simulator Icon">
                Particle Physics Simulator
                <button class="close-btn">&times;</button>
            </div>
            <div class="window-content">
                <div id="simulator-controls">
                    <button onclick="startSimulation()">Start</button>
                    <button onclick="pauseSimulation()">Pause</button>
                    <select id="particle-type">
                        <option value="electron">Electron</option>
                        <option value="proton">Proton</option>
                        <option value="neutron">Neutron</option>
                    </select>
                    <input type="range" id="energy-level" min="1" max="100" value="50">
                </div>
                <canvas id="simulator-visualization"></canvas>
            </div>
        </div>
    </div>

    <div class="window" id="quantumconnect-window" style="width: 800px; height: 600px; top: 60px; left: 300px;">
        <div class="window-header">
            <img src="https://img.icons8.com/color/48/000000/atomic-orbital.png" class="window-icon" alt="QuantumConnect Icon">
            QuantumConnect
            <button class="close-btn">&times;</button>
        </div>
        <div class="window-content">
            <div id="quantum-notification-badge" class="notification-badge" style="display: none;"></div>
            <div id="quantumconnect-nav">
                <button onclick="showQuantumFeed()">Feed</button>
                <button onclick="showQuantumProfile()">Profile</button>
                <button onclick="showQuantumInfluencers()">Top Influencers</button>
                <button onclick="showQuantumTrends()">Trending</button>
                <button onclick="showQuantumMessages()">Messages</button>
                <input type="text" id="quantum-search-input" placeholder="Search users or posts...">
                <button onclick="searchQuantumUsers(document.getElementById('quantum-search-input').value)">Search</button>
            </div>
            <div id="quantumconnect-main">
                <!-- Content will be dynamically inserted here -->
            </div>
        </div>
    </div>
    
    <div id="taskbar">
        <div class="taskbar-item" onclick="toggleWindow('browser')">Browser</div>
        <div class="taskbar-item" onclick="toggleWindow('lhc-status')">LHC Status</div>
        <div class="taskbar-item" onclick="toggleWindow('exoplanet-archive')">Exoplanets</div>
        <div class="taskbar-item" onclick="toggleWindow('temperature-chart')">Global Temp</div>
        <div class="taskbar-item" onclick="toggleFocusMode()">Focus Mode</div>
        <div id="clock"></div>
    </div>

    <div class="focus-mode">
        <p>Focus Mode Activated</p>
        <p>Press Esc to exit</p>
    </div>

    <div class="pomodoro-timer">
        <span id="pomodoro-time">25:00</span>
        <button onclick="startPomodoro()">Start</button>
        <button onclick="resetPomodoro()">Reset</button>
    </div>
    
    <textarea class="note-taking" placeholder="Quick notes..."></textarea>

    <div class="window" id="science-social" style="width: 400px; height: 600px; top: 50px; left: 450px;">
        <div class="window-header">
            ScienceNet
            <button class="close-btn">&times;</button>
        </div>
        <div class="window-content">
            <div id="science-feed"></div>
            <button onclick="loadMorePosts()">Load More</button>
        </div>
    </div>
    
    <style>
        #science-social .window-content {
            padding: 0;
            overflow-y: auto;
        }
        .post {
            border-bottom: 1px solid #e1e4e8;
            padding: 15px;
        }
        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .post-author {
            font-weight: bold;
        }
        .post-meta {
            font-size: 0.8em;
            color: #666;
        }
        .post-content {
            margin-bottom: 10px;
        }
        .post-image {
            max-width: 100%;
            height: auto;
            margin-bottom: 10px;
        }
        .post-link {
            background-color: #f1f3f5;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
        }
        .post-poll {
            background-color: #f1f3f5;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
        }
        .poll-option {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .poll-bar {
            height: 20px;
            background-color: #4a69bd;
            margin-right: 10px;
        }
        .post-actions {
            display: flex;
            justify-content: space-between;
        }
        .post-action {
            color: #4a69bd;
            cursor: pointer;
        }
        .post-action.active {
            font-weight: bold;
        }
    </style>
    <script>
    // Simulated data
    const scientists = [
        "Dr. Emily Quantum", "Prof. Alex Neuroscience", "Dr. Sarah Climatology", "Prof. Michael Genetics",
        "Dr. Lisa Astrophysics", "Prof. David Immunology", "Dr. Robert AI", "Prof. Jennifer Ecology",
        "Dr. Thomas Physics", "Prof. Laura Botany", "Dr. Maria Biochemistry", "Prof. John Archaeology",
        "Dr. Karen Marine Biology", "Prof. Steve Geology", "Dr. Rachel Virology", "Prof. Daniel Mathematics"
    ];
    
    const institutions = [
        "MIT", "Stanford University", "Harvard University", "CalTech", "Oxford University", "Cambridge University",
        "ETH Zurich", "Imperial College London", "University of Tokyo", "Peking University", "CERN", "NASA",
        "Max Planck Institute", "Scripps Research Institute", "Weizmann Institute of Science", "CNRS"
    ];
    
    const journals = [
        "Nature", "Science", "Cell", "The Lancet", "NEJM", "PNAS", "Physical Review Letters",
        "Journal of Neuroscience", "Ecology", "Genome Research", "Immunity", "Nano Letters"
    ];
    
    const topics = [
        "quantum computing", "neuroscience", "climate change", "genetic engineering", "exoplanets",
        "vaccine development", "artificial intelligence", "marine biology", "particle physics",
        "plant communication", "CRISPR", "dark matter", "stem cell research", "biodiversity",
        "renewable energy", "nanotechnology", "epigenetics", "gravitational waves"
    ];
    
    function generatePost() {
        const type = Math.random();
        const author = scientists[Math.floor(Math.random() * scientists.length)];
        const institution = institutions[Math.floor(Math.random() * institutions.length)];
        const topic = topics[Math.floor(Math.random() * topics.length)];
        const journal = journals[Math.floor(Math.random() * journals.length)];
    
        let post = {
            author: author,
            institution: institution,
            timestamp: new Date(Date.now() - Math.floor(Math.random() * 7 * 24 * 60 * 60 * 1000)).toISOString(),
            likes: Math.floor(Math.random() * 1000),
            comments: Math.floor(Math.random() * 100),
            shares: Math.floor(Math.random() * 50)
        };
    
        if (type < 0.6) { // Text post
            post.content = `Exciting progress in our ${topic} research! We've just ${
                Math.random() < 0.5 ? "submitted" : "published"
            } our findings to ${journal}. This could have significant implications for ${
                topics[Math.floor(Math.random() * topics.length)]
            }. #ScienceAdvancement #${topic.replace(/\s+/g, '')}`;
        } else if (type < 0.8) { // Image post
            post.content = `Check out this fascinating ${
                Math.random() < 0.5 ? "image" : "graph"
            } from our recent ${topic} experiment. It clearly shows the ${
                Math.random() < 0.5 ? "correlation" : "causation"
            } we've been hypothesizing. #DataVisualization #${topic.replace(/\s+/g, '')}`;
            post.image = `https://picsum.photos/seed/${Math.random()}/400/300`;
        } else if (type < 0.9) { // Link post
            post.content = `Just published: "${capitalizeFirstLetter(topic)} - A New Frontier". Read our latest paper in ${journal}:`;
            post.link = `https://${journal.toLowerCase().replace(/\s+/g, '')}.org/articles/${Math.floor(Math.random() * 1000000)}`;
        } else { // Poll post
            post.content = `What do you think is the most promising application of ${topic}?`;
            post.poll = {
                options: [
                    {text: `Medical advancements`, votes: Math.floor(Math.random() * 100)},
                    {text: `Technological innovation`, votes: Math.floor(Math.random() * 100)},
                    {text: `Environmental protection`, votes: Math.floor(Math.random() * 100)},
                    {text: `Space exploration`, votes: Math.floor(Math.random() * 100)}
                ]
            };
        }
    
        return post;
    }
    
    function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }
    
    function createPostHTML(post) {
        const randomId = Math.floor(Math.random() * 1000000);
        let postContent = `
            <div class="post">
                <div class="post-header">
                    <img src="https://picsum.photos/seed/${randomId}/40" alt="Avatar" class="post-avatar">
                    <div>
                        <span class="post-author">${post.author}</span>
                        <div class="post-meta">${post.institution} • ${timeAgo(new Date(post.timestamp))}</div>
                    </div>
                </div>
                <div class="post-content">${post.content}</div>
        `;
    
        if (post.image) {
            postContent += `<img src="${post.image}" alt="Post image" class="post-image">`;
        } else if (post.link) {
            postContent += `
                <div class="post-link">
                    <a href="${post.link}" target="_blank">${post.link}</a>
                </div>
            `;
        } else if (post.poll) {
            const totalVotes = post.poll.options.reduce((sum, option) => sum + option.votes, 0);
            postContent += `<div class="post-poll">`;
            post.poll.options.forEach(option => {
                const percentage = (option.votes / totalVotes * 100).toFixed(1);
                postContent += `
                    <div class="poll-option">
                        <div class="poll-bar" style="width: ${percentage}%"></div>
                        <span>${option.text}: ${percentage}% (${option.votes} votes)</span>
                    </div>
                `;
            });
            postContent += `</div>`;
        }
    
        postContent += `
                <div class="post-actions">
                    <span class="post-action" onclick="this.classList.toggle('active')">Like (${post.likes})</span>
                    <span class="post-action">Comment (${post.comments})</span>
                    <span class="post-action">Share (${post.shares})</span>
                </div>
            </div>
        `;
    
        return postContent;
    }
    
    function timeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);
        let interval = seconds / 31536000;
        if (interval > 1) return Math.floor(interval) + " years ago";
        interval = seconds / 2592000;
        if (interval > 1) return Math.floor(interval) + " months ago";
        interval = seconds / 86400;
        if (interval > 1) return Math.floor(interval) + " days ago";
        interval = seconds / 3600;
        if (interval > 1) return Math.floor(interval) + " hours ago";
        interval = seconds / 60;
        if (interval > 1) return Math.floor(interval) + " minutes ago";
        return Math.floor(seconds) + " seconds ago";
    }
    
    function loadMorePosts() {
        const feed = document.getElementById('science-feed');
        for (let i = 0; i < 5; i++) {
            const post = generatePost();
            feed.innerHTML += createPostHTML(post);
        }
    }
    
    // Simulated real-time updates
    setInterval(() => {
        const feed = document.getElementById('science-feed');
        const newPost = generatePost();
        feed.insertAdjacentHTML('afterbegin', createPostHTML(newPost));
        if (feed.children.length > 50) {
            feed.lastElementChild.remove();
        }
    }, 30000); // Add a new post every 30 seconds
    
    // Add this to your taskbar
    document.getElementById('taskbar').innerHTML += `
        <div class="taskbar-item" onclick="toggleWindow('science-social')">ScienceNet</div>
    `;

    document.getElementById('taskbar').innerHTML += `
        <div class="taskbar-item" onclick="toggleWindow('iss-livestream')">ISS Live</div>
    `;
    </script>
    <script>
        // Virtual Lab Functions
        function runExperiment() {
            const experimentType = document.getElementById('experiment-type').value;
            const labVisualization = document.getElementById('lab-visualization');
            labVisualization.innerHTML = `<p>Running ${experimentType} experiment...</p>`;
            // Simulate experiment progress
            setTimeout(() => {
                labVisualization.innerHTML += '<p>Experiment complete. Ready for analysis.</p>';
            }, 3000);
        }

        function analyzeResults() {
            const labVisualization = document.getElementById('lab-visualization');
            labVisualization.innerHTML += '<p>Analyzing results...</p>';
            // Simulate analysis
            setTimeout(() => {
                labVisualization.innerHTML += '<p>Analysis complete. Results: [Simulated data]</p>';
            }, 2000);
        }

        // Revised AI Research Assistant

let model;
const MAX_HISTORY = 3;
let conversationHistory = [];

async function loadModel() {
    const { pipeline } = await import('https://cdn.jsdelivr.net/npm/@xenova/transformers@2.5.0');
    model = await pipeline('text-generation', 'Xenova/distilgpt2-scientific-papers-355M');
}

async function generateResponse(input) {
    try {
        const context = conversationHistory
            .slice(-MAX_HISTORY)
            .map(entry => `${entry.role}: ${entry.content}`)
            .join('\n');
        
        const prompt = `The following is a conversation with an AI research assistant specialized in scientific topics.\n\n${context}\nHuman: ${input}\nAI:`;
        
        const result = await model(prompt, {
            max_new_tokens: 100,
            temperature: 0.7,
            top_k: 50,
            top_p: 0.95,
            no_repeat_ngram_size: 2,
        });

        let response = result[0].generated_text.split('AI:').pop().trim();
        response = response.split('Human:')[0].trim();
        return response;
    } catch (error) {
        console.error('Error generating response:', error);
        return "I apologize, but I encountered an error. Could you please try again?";
    }
}

async function askAI() {
    const inputElement = document.getElementById('ai-query');
    const query = inputElement.value.trim();
    if (!query) return;

    const chatElement = document.getElementById('ai-chat');
    chatElement.innerHTML += `<p><strong>You:</strong> ${query}</p>`;
    conversationHistory.push({ role: "Human", content: query });

    inputElement.value = '';
    chatElement.innerHTML += `<p><em>AI is thinking...</em></p>`;
    chatElement.scrollTop = chatElement.scrollHeight;

    try {
        const response = await generateResponse(query);
        chatElement.innerHTML = chatElement.innerHTML.replace('<p><em>AI is thinking...</em></p>', '');
        chatElement.innerHTML += `<p><strong>AI:</strong> ${response}</p>`;
        conversationHistory.push({ role: "AI", content: response });
    } catch (error) {
        console.error('Error in askAI:', error);
        chatElement.innerHTML = chatElement.innerHTML.replace('<p><em>AI is thinking...</em></p>', '');
        chatElement.innerHTML += `<p><strong>AI:</strong> I apologize, but I encountered an error. Please try again.</p>`;
    }

    chatElement.scrollTop = chatElement.scrollHeight;
}

// Initialize the AI assistant
document.addEventListener('DOMContentLoaded', async () => {
    try {
        await loadModel();
        document.getElementById('ai-chat').innerHTML = "<p><strong>AI:</strong> Model loaded. I'm ready to assist with scientific topics. What would you like to know?</p>";
    } catch (error) {
        console.error('Error initializing model:', error);
        document.getElementById('ai-chat').innerHTML = "<p><strong>AI:</strong> I apologize, but I encountered an error while initializing. Please refresh the page or try again later.</p>";
    }
});

// Add event listener for the AI query input
document.getElementById('ai-query').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        askAI();
    }
});

        function toggleAudio() {
            const iframe = document.querySelector('#iss-livestream iframe');
            const src = iframe.src;
            if (src.includes('&mute=1')) {
                iframe.src = src.replace('&mute=1', '');
            } else {
                iframe.src = src + '&mute=1';
            }
        }
        
        function toggleFullscreen() {
            const elem = document.getElementById('iss-livestream');
            if (!document.fullscreenElement) {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) { /* Safari */
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) { /* IE11 */
                    elem.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) { /* Safari */
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { /* IE11 */
                    document.msExitFullscreen();
                }
            }
        }


        // Particle Physics Simulator Functions
        let simulationInterval;

        function startSimulation() {
            const canvas = document.getElementById('simulator-visualization');
            const ctx = canvas.getContext('2d');
            const particleType = document.getElementById('particle-type').value;
            const energyLevel = document.getElementById('energy-level').value;

            clearInterval(simulationInterval);
            simulationInterval = setInterval(() => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.beginPath();
                ctx.arc(Math.random() * canvas.width, Math.random() * canvas.height, energyLevel / 10, 0, 2 * Math.PI);
                ctx.fillStyle = particleType === 'electron' ? 'blue' : (particleType === 'proton' ? 'red' : 'green');
                ctx.fill();
            }, 100);
        }

        function pauseSimulation() {
            clearInterval(simulationInterval);
        }

        document.getElementById('taskbar').innerHTML += `
            <div class="taskbar-item" onclick="toggleWindow('virtual-lab')">Virtual Lab</div>
            <div class="taskbar-item" onclick="toggleWindow('ai-assistant')">AI Assistant</div>
            <div class="taskbar-item" onclick="toggleWindow('particle-simulator')">Particle Sim</div>
        `;
    </script>
    <script>
            function toggleFocusMode() {
            const focusMode = document.querySelector('.focus-mode');
            focusMode.style.display = focusMode.style.display === 'none' ? 'flex' : 'none';
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelector('.focus-mode').style.display = 'none';
            }
        });

        let pomodoroInterval;
        let pomodoroTime = 25 * 60; // 25 minutes

        function startPomodoro() {
            clearInterval(pomodoroInterval);
            pomodoroInterval = setInterval(function() {
                pomodoroTime--;
                updatePomodoroDisplay();
                if (pomodoroTime === 0) {
                    clearInterval(pomodoroInterval);
                    alert('Pomodoro session completed! Take a break.');
                }
            }, 1000);
        }

        function resetPomodoro() {
            clearInterval(pomodoroInterval);
            pomodoroTime = 25 * 60;
            updatePomodoroDisplay();
        }

        function updatePomodoroDisplay() {
            const minutes = Math.floor(pomodoroTime / 60);
            const seconds = pomodoroTime % 60;
            document.getElementById('pomodoro-time').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        const RSS_FEEDS = [
            {
                url: 'https://rss.sciencedaily.com/all.xml',
                name: 'Science Daily'
            },
            {
                url: 'http://feeds.nature.com/nature/rss/current',
                name: 'Nature'
            },
            {
                url: 'https://www.sciencemag.org/rss/news_current.xml',
                name: 'Science Magazine'
            },
            {
                url: 'https://phys.org/rss-feed/',
                name: 'Phys.org'
            },
            {
                url: 'https://www.newscientist.com/feed/home/',
                name: 'New Scientist'
            }
        ];
        
        // Simulated browser content
        const pages = {
             "https://nexussearch.com": getSearchPageHTML()
        };
        
        let browserHistory = [];
        let currentPageIndex = -1;

        function navigateTo(url, pushToHistory = true) {
            if (!url) {
                url = document.getElementById('url-bar').value;
            }
            url = ensureHttps(url);
            
            if (url === 'https://nexussearch.com') {
                document.getElementById('browser-content').innerHTML = getSearchPageHTML();
            } else if (url.startsWith('https://nexussearch.com/article/')) {
                // The content is already displayed by displayRSSContentPage, so we don't need to do anything here
            } else if (pages[url]) {
                document.getElementById('browser-content').innerHTML = pages[url];
            } else if (url.includes('arxiv.org')) {
                const pdfUrl = url.replace('abs', 'pdf') + '.pdf';
                document.getElementById('browser-content').innerHTML = `
                    <iframe id="pdf-viewer" src="https://docs.google.com/viewer?url=${encodeURIComponent(pdfUrl)}&embedded=true"></iframe>
                `;
            } else {
                document.getElementById('browser-content').innerHTML = `
                    <h1>${url}</h1>
                    <p>This is a simulated view of an external website.</p>
                    <p>In a real browser, you would see the actual content of ${url} here.</p>
                `;
            }
            document.getElementById('url-bar').value = url;
        
            if (pushToHistory) {
                if (currentPageIndex < browserHistory.length - 1) {
                    browserHistory = browserHistory.slice(0, currentPageIndex + 1);
                }
                browserHistory.push(url);
                currentPageIndex = browserHistory.length - 1;
            }
            updateNavigationButtons();
        }

        function updateNavigationButtons() {
            const backButton = document.querySelector('.browser-bar button:nth-child(1)');
            const forwardButton = document.querySelector('.browser-bar button:nth-child(2)');
            backButton.disabled = currentPageIndex <= 0;
            forwardButton.disabled = currentPageIndex >= browserHistory.length - 1;
        }
    
        function goBack() {
            if (currentPageIndex > 0) {
                currentPageIndex--;
                navigateTo(browserHistory[currentPageIndex], false);
            }
        }
    
        function goForward() {
            if (currentPageIndex < browserHistory.length - 1) {
                currentPageIndex++;
                navigateTo(browserHistory[currentPageIndex], false);
            }
        }

        function getSearchPageHTML() {
            return `
                <div class="nexus-search-container">
                    <div class="nexus-logo">
                        <h1>Nexus<span>Search</span></h1>
                    </div>
                    <form onsubmit="performNexusSearch(); return false;">
                        <div class="nexus-search-bar">
                            <input type="text" id="nexus-search-input" class="nexus-search-input" placeholder="Explore the knowledge nexus...">
                            <button type="submit" class="nexus-search-button">Search</button>
                        </div>
                    </form>
                    <div id="nexus-search-results" class="nexus-search-results"></div>
                </div>
            `;
        }
        
        function ensureHttps(url) {
            if (!/^https?:\/\//i.test(url)) {
                url = 'https://' + url;
            }
            return url.replace('http://', 'https://');
        }

        // Global Temperature Chart
        const tempCtx = document.getElementById('temperatureChart').getContext('2d');
        new Chart(tempCtx, {
            type: 'line',
            data: {
                labels: ['1880', '1900', '1920', '1940', '1960', '1980', '2000', '2020'],
                datasets: [{
                    label: 'Temperature Anomaly (°C)',
                    data: [-0.16, -0.08, -0.27, 0.12, 0.03, 0.26, 0.39, 0.98],
                    borderColor: 'rgb(255, 99, 132)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false
                    }
                }
            }
        });

        // Taskbar clock
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString();
        }

        setInterval(updateClock, 1000);
        updateClock();

        // Window management
        function toggleWindow(windowId) {
            const windows = {
                'browser': document.getElementById('browser'),
                'lhc-status': document.querySelector('.window:nth-child(2)'),
                'exoplanet-archive': document.querySelector('.window:nth-child(3)'),
                'temperature-chart': document.querySelector('.window:nth-child(4)'),
                'science-social': document.getElementById('science-social'),
                'virtual-lab': document.getElementById('virtual-lab'),
                'ai-assistant': document.getElementById('ai-assistant'),
                'iss-livestream': document.getElementById('iss-livestream'),
                'particle-simulator': document.getElementById('particle-simulator'),
                'quantumconnect-window': document.getElementById('quantumconnect-window')
            };
        
            const window = windows[windowId];
            if (window) {
                if (windowId === 'browser') {
                    window.classList.toggle('minimized');
                } else {
                    window.style.display = window.style.display === 'none' ? 'block' : 'none';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const urlBar = document.getElementById('url-bar');
            urlBar.addEventListener('click', function() {
                const browser = document.getElementById('browser');
                browser.classList.remove('minimized');
            });
            // Initialize browser
            navigateTo("https://nexussearch.com");
            
            // Make windows draggable
            document.querySelectorAll('.window').forEach(makeWindowDraggable);
            
            // Reset z-index initially
            resetZIndex();
                
            updatePomodoroDisplay();

            // Initialize ScienceNet
            loadMorePosts();
            
            // Make the new window draggable
            makeWindowDraggable(document.getElementById('science-social'));
            
            makeWindowDraggable(document.getElementById('virtual-lab'));
            makeWindowDraggable(document.getElementById('ai-assistant'));
            makeWindowDraggable(document.getElementById('iss-livestream'));
            makeWindowDraggable(document.getElementById('particle-simulator'));
        });
        
        const ARXIV_API_BASE = 'https://export.arxiv.org/api/query';
        
        async function searchArXiv(query) {
            try {
                const response = await axios.get(ARXIV_API_BASE, {
                    params: {
                        search_query: `all:${query}`,
                        start: 0,
                        max_results: 5
                    }
                });
        
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(response.data, "text/xml");
                const entries = xmlDoc.getElementsByTagName("entry");
        
                return Array.from(entries).map(entry => ({
                    title: entry.getElementsByTagName("title")[0].textContent,
                    authors: Array.from(entry.getElementsByTagName("author")).map(author => author.getElementsByTagName("name")[0].textContent).join(", "),
                    date: new Date(entry.getElementsByTagName("published")[0].textContent).toLocaleDateString(),
                    url: ensureHttps(entry.getElementsByTagName("id")[0].textContent),
                    source: 'arXiv'
                }));
            } catch (error) {
                console.error('Error searching arXiv:', error);
                return [];
            }
        }
            
        async function fetchRSSFeed(url, feedName) {
            try {
                const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`);
                
                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.statusText}`);
                }
                const text = await response.text();
                // Try parsing the JSON
                let data;
                try {
                    data = JSON.parse(text);
                } catch (parseError) {
                    console.error('Failed to parse JSON:', parseError);
                    throw new Error('Failed to parse JSON');
                }
        
                if (data.status !== 'ok') {
                    throw new Error('Failed to fetch RSS feed');
                }
        
                return data.items.map(item => ({
                    title: item.title,
                    authors: item.author || 'RSS Feed Author',
                    url: item.link,
                    date: new Date(item.pubDate).toISOString().split('T')[0],
                    snippet: item.description.replace(/<[^>]*>?/gm, '').slice(0, 150) + "...",
                    source: feedName,
                    fullContent: item.content,
                    image: item.thumbnail || item.enclosure?.link
                }));
            } catch (error) {
                console.error(`Error fetching RSS feed (${feedName}):`, error);
                return [];
            }
        }

        async function performNexusSearch() {
            const query = document.getElementById('nexus-search-input').value.toLowerCase();
            document.getElementById('nexus-search-results').innerHTML = '<p>Searching the nexus of knowledge...</p>';
            
            try {
                const arxivResults = await searchArXiv(query);
                
                const rssPromises = RSS_FEEDS.map(feed => fetchRSSFeed(feed.url, feed.name));
                const rssResults = await Promise.all(rssPromises);
                
                const allRssResults = rssResults.flat();
                
                const filteredRssResults = allRssResults.filter(item => 
                    item.title.toLowerCase().includes(query) || 
                    item.snippet.toLowerCase().includes(query)
                );
        
                const combinedResults = [...arxivResults, ...filteredRssResults];
                displayNexusResults(combinedResults);
            } catch (error) {
                console.error('Error performing search:', error);
                document.getElementById('nexus-search-results').innerHTML = '<p>An error occurred while searching. Please try again.</p>';
            }
        }
    
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function displayNexusResults(results) {
            let html = '';
            if (results.length === 0) {
                html = '<p>No results found. Try a different search term.</p>';
            } else {
                results.forEach((result, index) => {
                    const escapedResult = escapeHtml(JSON.stringify(result));
                    html += `
                        <div class="nexus-result-item" data-result='${escapedResult}'>
                            <h3 class="nexus-result-title">
                                <a href="#">${result.title}</a>
                            </h3>
                            <p class="nexus-result-meta">
                                ${result.authors ? `Authors: ${result.authors} | ` : ''}
                                Published: ${result.date} | 
                                Source: ${result.source}
                            </p>
                            <div class="content">
                                ${result.fullContent || result.snippet}
                            </div>
                        </div>
                    `;
                });
            }
            document.getElementById('nexus-search-results').innerHTML = html;
        }


        function displayRSSContentPage(result) {
            const contentHtml = `
                <div class="rss-content-page">
                    <h1>${result.title}</h1>
                    <p class="meta">
                        ${result.authors ? `Author: ${result.authors} | ` : ''}
                        Published: ${result.date} | 
                        Source: ${result.source}
                    </p>
                    ${result.image ? `<img src="${result.image}" alt="${result.title}" style="max-width: 100%; height: auto; margin-bottom: 20px;">` : ''}
                    <div class="content">
                        ${result.fullContent || result.snippet}
                    </div>
                    <p><a href="${result.url}" target="_blank">Read full article at ${result.source}</a></p>
                </div>
            `;
            document.getElementById('browser-content').innerHTML = contentHtml;
            document.getElementById('url-bar').value = `https://nexussearch.com/article/${encodeURIComponent(result.title.toLowerCase().replace(/ /g, '-'))}`;
        }
    
        function generateSnippet(title) {
            // This function generates a fake snippet based on the title
            const snippets = [
                "This groundbreaking research explores the implications of " + title.toLowerCase() + " on various scientific fields.",
                "An in-depth analysis of " + title.toLowerCase() + " reveals surprising connections to other areas of study.",
                "Researchers have made significant progress in understanding " + title.toLowerCase() + ", opening new avenues for future investigations.",
                "The study of " + title.toLowerCase() + " has led to innovative approaches in tackling complex scientific problems.",
                "Recent advancements in " + title.toLowerCase() + " are reshaping our understanding of fundamental scientific principles."
            ];
            return snippets[Math.floor(Math.random() * snippets.length)];
        }

        function handleResultClick(event, index, result) {
            event.preventDefault();
            if (result.source !== 'arXiv') {
                displayRSSContentPage(result);
            } else {
                navigateTo(result.url);
            }
        }
        
        document.addEventListener('click', function(e) {
            if (e.target.closest('.nexus-result-item')) {
                // This is for search results
                e.preventDefault();
                const resultItem = e.target.closest('.nexus-result-item');
                const index = Array.from(resultItem.parentNode.children).indexOf(resultItem);
                const result = JSON.parse(resultItem.dataset.result);
                handleResultClick(e, index, result);
            } else if (e.target.tagName === 'A') {
                e.preventDefault();
                navigateTo(e.target.href);
            }
        });
        
        // Make windows draggable
        document.querySelectorAll('.window').forEach(makeWindowDraggable);

        function makeWindowDraggable(window) {
            const header = window.querySelector('.window-header');
            let isDragging = false;
            let offsetX, offsetY;
        
            header.addEventListener('mousedown', (e) => {
                isDragging = true;
                offsetX = e.clientX - window.getBoundingClientRect().left;
                offsetY = e.clientY - window.getBoundingClientRect().top;
                window.style.zIndex = 1000; // Set a high z-index when dragging
            });
        
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    window.style.left = (e.clientX - offsetX) + 'px';
                    window.style.top = (e.clientY - offsetY) + 'px';
                }
            });
        
            document.addEventListener('mouseup', () => {
                isDragging = false;
                resetZIndex(); // Reset z-index of all windows
            });
        }
    
        function resetZIndex() {
            const windows = document.querySelectorAll('.window');
            windows.forEach(window => {
                if (window.id === 'browser') {
                    window.style.zIndex = 2;
                } else {
                    window.style.zIndex = 1;
                }
            });
        }
      
        // Make the QuantumConnect window draggable
        makeWindowDraggable(document.getElementById('quantumconnect-window'));
        
        // Add QuantumConnect to the taskbar
        document.getElementById('taskbar').innerHTML += `
            <div class="taskbar-item" onclick="toggleWindow('quantumconnect-window')">QuantumConnect</div>
        `;
        
        // // Initialize QuantumConnect when the window is opened
        // document.querySelector('#quantumconnect-window .window-content').addEventListener('DOMNodeInserted', function(event) {
        //     if (event.target === this) {
        //         initQuantumConnect();
        //     }
        // });
        initQuantumConnect();
        startRealTimeUpdates();

        // Initialize browser
        navigateTo("https://nexussearch.com");
    </script>
</body>
</html>
